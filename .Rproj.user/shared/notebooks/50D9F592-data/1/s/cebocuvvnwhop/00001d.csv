"0","displacement <- read_csv(here(""data"", ""displacement_data.csv"")) |> 
  janitor::clean_names() |> 
  mutate(country_iso = countrycode(country, 
                                   origin = ""country.name"", 
                                   destination = ""iso3c"")) |> 
  filter(year > 2007) |>
  pivot_wider(names_from = indicator_sub_type, 
              values_from = sum_of_value) |> 
  janitor::clean_names() |>
  replace_na(list(disaster_new_displacement = 0, 
                  conflict_stock_displacement = 0, 
                  conflict_new_displacement = 0)) |> 
  mutate(total_displacement = 
           disaster_new_displacement + 
           conflict_stock_displacement +
           conflict_new_displacement) |> 
  left_join(population_estimates |> 
              filter(year %in% c(2017, 2018, 2019)), 
            by = c(""country"", ""year"")) |>
  mutate(disaster_per_100k = disaster_new_displacement / population * 100000, 
         conflict_per_100k = (conflict_stock_displacement +
                                  conflict_new_displacement) / population * 100000, 
         total_displacement_100k = total_displacement / population * 100000, 
         conflict_subtotal_displacement = 
           conflict_stock_displacement + conflict_new_displacement)  %>%
  mutate_at(vars(disaster_per_100k,
                 conflict_per_100k, 
                 total_displacement_100k), 
            ~ round(., digits = 6)) |> 
  replace_na(list(disaster_new_displacement = 0, 
                  conflict_stock_displacement = 0, 
                  conflict_new_displacement = 0, 
                  population = 0, 
                  disaster_per_100k = 0, 
                  conflict_per_100k = 0, 
                  total_displacement = 0, 
                  total_displacement_100k = 0, 
                  conflict_subtotal_displacement = 0)) 
"
"1","[1mRows: [22m[34m133[39m [1mColumns: [22m[34m4[39m
"
"1","[36mâ”€â”€[39m [1mColumn specification[22m [36mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m
[1mDelimiter:[22m "",""
[31mchr[39m (2): Country, Indicator_SubType
[32mdbl[39m (2): Sum of Value, Year
"
"1","
[36mâ„¹[39m Use `spec()` to retrieve the full column specification for this data.
[36mâ„¹[39m Specify the column types or set `show_col_types = FALSE` to quiet this message.
"
