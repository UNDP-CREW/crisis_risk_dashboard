country_iso = countrycode::countrycode(country,
origin = "country.name",
destination = "iso3c")) |>
filter(!is.na(country) &
country %out% c("Data from database: World Development Indicators",
"Last Updated: 06/28/2024"))
population_estimates <- crossing(country = population$country, year = 2000:2024) |>
left_join(population |>
select(year, country, population),
by = c("year", "country")) |>
group_by(country) %>%
fill(population, .direction = "updown")
range01 <- function(x){(x-min(x))/(max(x)-min(x))}
range_wna <- function(x){(x-min(x, na.rm = TRUE))/(max(x, na.rm = TRUE)-min(x, na.rm = TRUE))}
islands <- read_xlsx(here("data", "Atoll - Island-Level-Indicator-Sheet-Population Cleaned V1.xlsx"),
sheet = 1,
skip = 7,
col_names = island_colnames) |>
slice(1:186) |>
rename(island = Locality) |>
left_join(
islands_atolls,
by = c("island", "Atoll")
) |>
pivot_longer(cols = `Resident Population Both sexes`:`Median Age Resident Foreigners`,
names_to = "indicator_full",
values_to = "value") |>
filter(!str_detect(indicator_full, "Resident Maldivians 2014")) |>
mutate(sex_modifier =
case_when(
str_detect(indicator_full, "Both sexes") ~ "Both sexes",
str_detect(indicator_full, "Male") ~ "Male",
str_detect(indicator_full, "Female") ~ "Female",
TRUE ~ NA_character_
),
population_modifier =
case_when(
str_detect(indicator_full, "Resident Population") ~ "Resident Population",
str_detect(indicator_full, "Resident Maldivian") ~ "Resident Maldivians",
str_detect(indicator_full, "Residnet Foreign") ~ "Resident Foreigners",
TRUE ~ NA_character_
)) |>
left_join(
atolls_official |>
distinct(atoll_official = Atoll, atoll_official_name = `Atoll Official Name`),
by = "atoll_official"
) |>
filter(!is.na(population_modifier)) |>
mutate(concat = paste0(island, ", ", atoll_official)) |>
filter(indicator_full %out% c("Median Age Resident Foreigners",
"Resident Foreigners Population Both sexes")) |>
mutate(indicator = str_remove(indicator_full, "Resident Maldivian Population"),
indicator2 = indicator,
value2 = value,
index = paste0(island, ", ",  Atoll))
island_cols <- read_xlsx(here("data", "Atoll - Island-Level-Indicator-Sheet-Population Cleaned V1.xlsx"),
sheet = 1,
.name_repair = "unique_quiet") |>
slice(1:4) |>
clean_names()
island_colnames <- island_cols |>
pivot_longer(cols = everything(),
names_to = "ignore",
values_to = "dirty") |>
filter(!is.na(dirty)) |>
group_by(ignore) %>%
mutate(across(everything(), ~paste0(.,collapse = " "))) |>
slice(1) |>
ungroup() |>
mutate(order = parse_number(ignore)) |>
mutate(order = case_when(
dirty == "Atoll" ~ 1,
dirty == "Growth Rate (for Resident Maldivian Population - 2014 to 2022)" ~ 15,
TRUE ~ order),
dirty = ifelse(dirty == "* Area (in hectare)",
"Area (in hectare)", dirty)) |>
arrange(order) |>
pull(dirty)
islands_atolls <- read_xlsx(here("data", "Atoll - Island-Level-Indicator-Sheet-Population Cleaned V1.xlsx"),
sheet = 1,
skip = 7,
col_names = island_colnames) |>
slice(1:186) |>
distinct(Atoll, island = Locality) |>
left_join(
maldives |>
mutate(Atoll = str_extract_all(atoll_local_names, "\\([^()]+\\)"),
Atoll = str_remove_all(Atoll, "\\(|\\)")) |>
filter(!is.na(island)) |>
distinct(Atoll, island, atoll_official) |>
mutate(Atoll = case_when(Atoll == "ADh" ~ "Adh",
TRUE ~ Atoll),
island = case_when(island == "Mundhoo" ~ "Mundoo",
island == "Madeveli" ~ "Madaveli",
TRUE ~ island)),
by = c("Atoll", "island")
) |>
arrange(atoll_official)
maldives <- read_excel(here("data", "Maldives Combined Datasets-Cleaned.xlsx")) |>
janitor::clean_names() |>
mutate(administration = case_when(
administration == "Administrative Islands & Non-administrative Islands" ~
"Administrative & Non-administrative Islands",
administration == "Non Administrative Islands" ~
"Non-administrative Islands",
TRUE ~ administration
)) |>
mutate(atoll_official = case_when(
atoll_official == "GNAVIYANI Atoll" ~ "Gnaviyani Atoll",
atoll_official == "LHAVIYANI Atoll" ~ "Lhaviyani Atoll",
atoll_official == "Male'|Male" ~ "Greater Male Region",
atoll_official == "NOONU Atoll" ~ "Noonu Atoll",
TRUE ~ atoll_official
)) |>
mutate(atoll_local_names =
case_when(
atoll_local_names == "Kaafu Atoll" ~ "Kaafu (K)",
TRUE ~ atoll_local_names
)) |>
naniar::replace_with_na(list(
island = "NA",
administration = "NA",
population = "NA"
)) |>
mutate(island_correct =
case_when(
island == "Bandidhoo" & atoll_official == "Dhaal Atoll" ~ "Badidhoo",
island == "Bilehdhoo" & atoll_official == "Faafu Atoll" ~ "Biledhdhoo",
island == "Dhanbidhoo" & atoll_official == "Laamu Atoll" ~ "Dhabidhoo",
island == "Faresmaathodaa" & atoll_official == "Gaaf Dhaal Atoll" ~ "Fares-Maathodaa",
island == "Fiyoaree" & atoll_official == "Gaaf Dhaal Atoll" ~ "Fiyoari",
island == "Hangnameedhoo" & atoll_official == "Alif Dhekunu Buri" ~ "Hanghghaameedhoo",
island == "Henbadhoo" & atoll_official == "Noonu Atoll" ~ "Hebadhoo",
island == "Himendhoo" & atoll_official == "Alif Uthuru Buri" ~ "Himandhoo",
island == "Hinmafushi" & atoll_official == "Kaafu Atoll" ~ "Himmafushi",
island == "Kedhikulhudhoo" & atoll_official == "Noonu Atoll" ~ "Kedhikolhudhoo",
island == "Kalaidhoo" & atoll_official == "Laamu Atoll" ~ "Kalhaidhoo",
island == "Kulhudhuffushi City" & atoll_official == "Haa Dhaal Atoll" ~ "Kalhaidhoo",
island == "Kuribi" & atoll_official == "Haa Dhaal Atoll" ~ "Kurinbi",
island == "Maaenboodhoo" & atoll_official == "Dhaal Atoll" ~ "Maaeboodhoo",
island == "Maalhos" & atoll_official == "Alif Uthuru Buri" ~ "Maalhoss",
island == "Maradhoo Feydhoo" & atoll_official == "Seenu Atoll" ~ "Maradhoo-Feydhoo",
island == "Nadellaa" & atoll_official == "Gaaf Dhaal Atoll" ~ "Nadallaa",
island == "Nolhivaranfaru" & atoll_official == "Haa Dhaal Atoll" ~ "Nolhivaramfaru",
island == "Thuraakunu" & atoll_official == "Haa Alif Atoll" ~ "Thurakunu",
island == "Dhagethi" & atoll_official == "Alif Dhekunu Buri" ~ "Dhangethi",
island == "Kunburudhoo" & atoll_official == "Alif Dhekunu Buri" ~ "Kunburudhoo",
island == "dharanboodhoo" & atoll_official == "Faafu Atoll" ~ "Dharaboodhoo",
island == "Vilingili" & atoll_official == "Gaaf Alif Atoll" ~ "Viligili",
island == "Molhadhoo" & atoll_official == "Haa Alif Atoll" ~ "Mulhadhoo",
island == "Inguraidhoo" & atoll_official == "Raa Atoll" ~ "Iguraidhoo",
island == "Ungoofaaru" & atoll_official == "Raa Atoll" ~ "Ugoofaaru",
island == "Hulhudhoo	" & atoll_official == "Seenu Atoll" ~ "Hulhumeedhoo",
island == "Kanditheemu" & atoll_official == "Shaviyani Atoll" ~ "Kaditheemu",
island == "Kinbidhoo" & atoll_official == "Thaa Atoll" ~ "Kibidhoo",
island %in% c("Nolhivaran", "Nolhivaramu") &
atoll_official == "Haa Dhaal Atoll" ~ "Nolhivaram",
TRUE ~ island
)) |>
mutate(population = ifelse(population == "Resident population", "Resident Population", population))
maldives_admin2 <- st_read(here("data",
"mdv_admbnd_gov_20210329_shp",
"mdv_admbnda_adm2_gov_20210329.shp"))
maldives_poverty <- read_excel(here("data", "Poverty Datasheet Maldives HIES 2019 (1).xlsx")) |>
janitor::clean_names() |>
slice(3:23) |>
rename(pc_below_poverty_line = percent_of_pop_below_national_poverty_line,
pc_national_poor = percent_of_national_poor) |>
naniar::replace_with_na(list(pc_below_poverty_line = "No data")) |>
mutate(pc_below_poverty_line = as.numeric(pc_below_poverty_line),
atoll = str_trim(atoll)) |>
pivot_longer(cols = c(pc_below_poverty_line, pc_national_poor),
names_to = "indicator",
values_to = "value") |>
mutate(atoll = case_when(
atoll == "Lhaviyani ( (Lh)" ~ "Lhaviyani (Lh)",
TRUE ~ atoll
)) |>
left_join(
maldives |>
distinct(atoll_official, atoll_local_names) |>
mutate(atoll_local_names = str_trim(atoll_local_names)),
by = c("atoll" = "atoll_local_names")
) |>
mutate(atoll_official = case_when(
atoll == "Greater Male Region" ~ "Greater Male Region",
str_detect(atoll, "Haa Alif") ~ "Haa Alif Atoll",
str_detect(atoll, "Gaafu Dhaalu") ~ "Gaaf Dhaal Atoll",
TRUE ~ atoll_official
),
indicator = case_when(indicator == "pc_below_poverty_line" ~ "% below poverty line",
indicator == "pc_national_poor" ~ "% of poor persons nationally")) |>
rename(atoll_local_names = atoll)
atolls_official <- read_csv(here("data", "marwa_atolls.csv"))
maldives |>
filter(!is.na(island) & indicator == "Population") |>
group_by(island = island_correct, atoll_official) |>
summarise(population = sum(value), .groups = "drop") |>
write_csv(here("data", "mal_island_population.csv"))
maldives |>
filter(!is.na(island) & indicator == "Population") |>
group_by(island = island_correct, atoll_official) |>
summarise(population = sum(value), .groups = "drop") |>
write_csv(here("data", "mal_island_population.csv"))
maldives |>
filter(!is.na(island) & indicator == "Population") |>
group_by(island = island_correct, atoll_official) |>
summarise(population = sum(value), .groups = "drop")
maldives |>
filter(!is.na(island) & indicator == "Population") |>
group_by(island = island_correct, atoll_official) |>
summarise(population = sum(value), .groups = "drop") |>
mutate(concat = paste0(island, ", ", atoll_official)) |>
write_csv(here("data", "mal_island_population.csv"))
islands_atolls <- read_xlsx(here("data", "Atoll - Island-Level-Indicator-Sheet-Population Cleaned V1.xlsx"),
sheet = 1,
skip = 7,
col_names = island_colnames) |>
slice(1:186) |>
distinct(Atoll, island = Locality) |>
left_join(
maldives |>
mutate(Atoll = str_extract_all(atoll_local_names, "\\([^()]+\\)"),
Atoll = str_remove_all(Atoll, "\\(|\\)")) |>
filter(!is.na(island)) |>
distinct(Atoll, island, atoll_official) |>
mutate(Atoll = case_when(Atoll == "ADh" ~ "Adh",
TRUE ~ Atoll),
island = case_when(island == "Mundhoo" ~ "Mundoo",
island == "Madeveli" ~ "Madaveli",
TRUE ~ island)),
by = c("Atoll", "island")
) |>
arrange(atoll_official)
islands <- read_xlsx(here("data", "Atoll - Island-Level-Indicator-Sheet-Population Cleaned V1.xlsx"),
sheet = 1,
skip = 7,
col_names = island_colnames) |>
slice(1:186) |>
rename(island = Locality) |>
left_join(
islands_atolls,
by = c("island", "Atoll")
) |>
pivot_longer(cols = `Resident Population Both sexes`:`Median Age Resident Foreigners`,
names_to = "indicator_full",
values_to = "value") |>
filter(!str_detect(indicator_full, "Resident Maldivians 2014")) |>
mutate(sex_modifier =
case_when(
str_detect(indicator_full, "Both sexes") ~ "Both sexes",
str_detect(indicator_full, "Male") ~ "Male",
str_detect(indicator_full, "Female") ~ "Female",
TRUE ~ NA_character_
),
population_modifier =
case_when(
str_detect(indicator_full, "Resident Population") ~ "Resident Population",
str_detect(indicator_full, "Resident Maldivian") ~ "Resident Maldivians",
str_detect(indicator_full, "Residnet Foreign") ~ "Resident Foreigners",
TRUE ~ NA_character_
)) |>
left_join(
atolls_official |>
distinct(atoll_official = Atoll, atoll_official_name = `Atoll Official Name`),
by = "atoll_official"
) |>
filter(!is.na(population_modifier)) |>
mutate(concat = paste0(island, ", ", atoll_official)) |>
filter(indicator_full %out% c("Median Age Resident Foreigners",
"Resident Foreigners Population Both sexes")) |>
mutate(indicator = str_remove(indicator_full, "Resident Maldivian Population"),
indicator2 = indicator,
value2 = value,
index = paste0(island, ", ",  Atoll))
islands |> glimpse()
islands |> count(indicator_full)
isalnds |>
filter(indicator_full == "Median Age Resident Maldivians") |>
glimpse()
islands |>
filter(indicator_full == "Median Age Resident Maldivians") |>
glimpse()
islands |>
filter(indicator_full == "Median Age Resident Maldivians") |>
ggplot(aes(x = value)) +
geom_histogram()
islands |>
filter(indicator_full == "Median Age Resident Maldivians") |>
count(value)
islands |> count(indicator_full)
islands |>
filter(indicator_full %in% c ("Median Age Resident Maldivians", "Population density Total Resident Population")) |>
glimpse()
islands |>
filter(indicator_full %in% c ("Median Age Resident Maldivians", "Population density Total Resident Population")) |>
pivot_wider(names_from = indicator, values_from = value) |>
glimpse()
islands |>
filter(indicator_full %in% c ("Median Age Resident Maldivians", "Population density Total Resident Population")) |>
pivot_wider(names_from = indicator, values_from = value) |>
ggplot(aes(x = `Population density Total Resident Population`, y = "`Median Age Resident Maldivians`")) +
geom_point()
islands |>
filter(indicator_full %in% c ("Median Age Resident Maldivians", "Population density Total Resident Population")) |>
pivot_wider(names_from = indicator, values_from = value) |>
ggplot(aes(x = `Population density Total Resident Population`, y = `Median Age Resident Maldivians`)) +
geom_point()
islands |>
filter(indicator_full %in% c ("Median Age Resident Maldivians", "Population density Total Resident Population")) |>
pivot_wider(names_from = indicator, values_from = value)
islands |>
filter(indicator_full %in% c ("Median Age Resident Maldivians", "Population density Total Resident Population")) |>
select(concat, indicator, value) |>
pivot_wider(names_from = indicator, values_from = value) |>
ggplot(aes(x = `Population density Total Resident Population`, y = `Median Age Resident Maldivians`)) +
geom_point()
islands |>
filter(indicator_full == "Resident Population Both sexes") |>
select(island, atoll_official, population = value) |>
left_join(
atolls_official |>
distinct(atoll_official = Atoll, `Atoll Official Name`),
by = c("atoll_official")
) |>
rename(atoll_local_name = `Atoll Official Name`) |>
mutate(concat = paste0(island, ", ", atoll_official)) |>
write_csv(here("data", "islands_pop.csv"))
islands |>
filter(indicator_full == "Resident Population Both sexes") |>
select(island, atoll_official, population = value) |>
left_join(
atolls_official |>
distinct(atoll_official = Atoll, `Atoll Official Name`),
by = c("atoll_official")
) |>
rename(atoll_local_name = `Atoll Official Name`) |>
mutate(concat = paste0(island, ", ", atoll_official))
islands |> count(indicator)
islands |> glimpse()
islands |> count(indicator_full)
islands |>
count(indicator)
islands |>
count(sex_modifier, population_modifier)
islands |> filter(is.na(sex_modifier)) |> count(indicator)
islands |>
count(sex_modifier, population_modifier)
islands |> filter(!is.na(sex_modifier)) |> count(indicator)
islands <- read_xlsx(here("data", "Atoll - Island-Level-Indicator-Sheet-Population Cleaned V1.xlsx"),
sheet = 1,
skip = 7,
col_names = island_colnames) |>
slice(1:186) |>
rename(island = Locality) |>
left_join(
islands_atolls,
by = c("island", "Atoll")
) |>
pivot_longer(cols = `Resident Population Both sexes`:`Median Age Resident Foreigners`,
names_to = "indicator_full",
values_to = "value") |>
filter(!str_detect(indicator_full, "Resident Maldivians 2014")) |>
mutate(sex_modifier =
case_when(
str_detect(indicator_full, "Both sexes") ~ "Both sexes",
str_detect(indicator_full, "Male") ~ "Male",
str_detect(indicator_full, "Female") ~ "Female",
TRUE ~ NA_character_
),
population_modifier =
case_when(
str_detect(indicator_full, "Resident Population") ~ "Resident Population",
str_detect(indicator_full, "Resident Maldivian") ~ "Resident Maldivians",
str_detect(indicator_full, "Residnet Foreign") ~ "Resident Foreigners",
TRUE ~ NA_character_
)) |>
left_join(
atolls_official |>
distinct(atoll_official = Atoll, atoll_official_name = `Atoll Official Name`),
by = "atoll_official"
) |>
filter(!is.na(population_modifier)) |>
mutate(concat = paste0(island, ", ", atoll_official)) |>
filter(indicator_full %out% c("Median Age Resident Foreigners",
"Resident Foreigners Population Both sexes")) |>
mutate(indicator = str_remove(indicator_full, "Resident Maldivian Population"),
indicator2 = indicator,
value2 = value) |>
mutate(index = case_when(
is.na(sex_modifier) ~ "Demographic statistics",
TRUE ~ "Population counts"
))
islands |> count(index, sex_modifier, population_modifier)
islands |> writexl::write_xlsx(here("data", "islands_indicators2.xlsx"))
islands |> writexl::write_xlsx(here("data", "islands_indicators1.xlsx"))
maldives_crimes <- maldives |>
filter(atoll_official %out% c("Industrial Islands", "Resorts")) |>
filter(indicator %in% c("Cases Sent for Prosecution",
"Economic and Financial Abuse",
"Emotional Abuse",
"Intimidating",
"Investigated Cases",
"Physical Abuse",
"Sexual Abuse",
"Sexual Harrasment",
"Stalking",
"Population",
"Reported Crimes")) |>
group_by(atoll_official, atoll_local_names, indicator) |>
summarise(value = sum(value)) |>
group_by(atoll_official, atoll_local_names) |>
mutate(population = ifelse(indicator == "Population", value, NA_integer_)) |>
fill(population, .direction = c("downup")) |>
ungroup() |>
filter(indicator != "Population") |>
mutate(value = value / population * 100000,
indicator = paste0(indicator, " per 100k")) |>
select(-population)
maldives_demographics <- maldives |>
filter(atoll_official %out% c("Industrial Islands", "Resorts")) |>
filter(indicator %in% c("Child Population (0-17 yrs)",
"Youth Population (National) (18-35 yrs)",
"Working Age Population (15-64 yrs)",
"Elderly Population (65+ yrs)",
"Adolescent Population (International) (10-19 yrs)",
"Population",
"Population density",
"Sex Ratio (males per 100 female)")) |>
group_by(atoll_official, atoll_local_names, indicator) |>
summarise(value = sum(value),
.groups = "drop")
maldives_economy <- maldives |>
filter(atoll_official %out% c("Industrial Islands", "Resorts")) |>
filter(indicator %in% c(
"Aged-Dependency Ratio",
"Child Dependency Ratio",
"Combined rate of unemployment and potential labour force (%)",
"Employment-to-population ratio (%)",
"Inactivity rate (%)",
"Dependency Ratio",
"Employment-to-population ratio (%)",
"Youth unemployment rate (15-24 years)",
"Youth unemployment rate (18-35years)",
"Labour force participation rate (%)",
"Median age",
"Growth Rate ( 2014 to 2022)",
"Unemployment rate (%)",
"NEET rate (15-24 years) (%)",
"NEET rate (18-35 years) (%)"
)) |>
group_by(atoll_official, atoll_local_names, indicator) |>
summarise(value = mean(value, na.rm = TRUE),
.groups = "drop")
maldives_atoll <- rbind(
maldives_poverty,
maldives_economy,
maldives_demographics,
maldives_crimes
) |>
left_join(
atolls_official |>
distinct(atoll_official = Atoll, atoll_official_name = `Atoll Official Name`),
by = "atoll_official"
) |>
group_by(indicator) |>
mutate(range = range_wna(value)) |>
ungroup() |>
mutate(indicator2 = indicator,
value2 = value,
range2 = range) |>
select(
atoll_official,
atoll_local_names,
atoll_official_name,
indicator,
value,
range,
indicator2,
value2,
range2
)
maldives_atoll |>
glimpse()
maldives_atoll |>
count(indicator)
islands |>
glimpse()
rbind(
maldives_atoll |>
count(indicator) |>
mutate(admin_level = "Atoll"),
islands |>
count(indicator) |>
mutate(admin_level = "Island"))
rbind(
maldives_atoll |>
count(indicator) |>
mutate(admin_level = "Atoll"),
islands |>
count(indicator) |>
mutate(admin_level = "Island")) |>
rename(observations = n)
rbind(
maldives_atoll |>
count(indicator) |>
mutate(admin_level = "Atoll"),
islands |>
count(indicator) |>
mutate(admin_level = "Island")) |>
rename(observations = n) |>
write_csv(here("data", "maldives_indicator_list.csv"))
