case_when(ignore == "population_island_level_indicator_sheet" ~ 1,
TRUE ~ parse_number(ignore))) |>
arrange(order)
dirty") |>
filter(!is.na(dirty)) |>
island_colnames <- island_cols |>
pivot_longer(cols = everything(),
names_to = "ignore",
island_colnames <- island_cols |>
pivot_longer(cols = everything(),
names_to = "ignore",
values_to = "dirty") |>
filter(!is.na(dirty)) |>
group_by(ignore) %>%
mutate(across(everything(), ~paste0(.,collapse = " "))) |>
slice(1) |>
ungroup() |>
mutate(order = parse_number(ignore)) |>
mutate(order = case_when(
dirty == "Atoll" ~ 1,
dirty == "Growth Rate (for Resident Maldivian Population - 2014 to 2022)" ~ 15,
TRUE ~ order),
dirty = ifelse(dirty == "* Area (in hectare)",
"Area (in hectare)", dirty)) |>
arrange(order) |>
pull(dirty)
islands_atolls <- read_xlsx(here("data", "Atoll - Island-Level-Indicator-Sheet-Population Cleaned V1.xlsx"),
sheet = 1,
skip = 7,
col_names = island_colnames) |>
slice(1:186) |>
distinct(Atoll, island = Locality) |>
left_join(
maldives |>
mutate(Atoll = str_extract_all(atoll_local_names, "\\([^()]+\\)"),
Atoll = str_remove_all(Atoll, "\\(|\\)")) |>
filter(!is.na(island)) |>
distinct(Atoll, island, atoll_official) |>
mutate(Atoll = case_when(Atoll == "ADh" ~ "Adh",
TRUE ~ Atoll),
island = case_when(island == "Mundhoo" ~ "Mundoo",
island == "Madeveli" ~ "Madaveli",
TRUE ~ island)),
by = c("Atoll", "island")
) |>
arrange(atoll_official)
islands <- read_xlsx(here("data", "Atoll - Island-Level-Indicator-Sheet-Population Cleaned V1.xlsx"),
sheet = 1,
skip = 7,
col_names = island_colnames) |>
slice(1:186) |>
left_join(
islands_atolls,
by = c("island", "Atoll")
)
islands_atolls
islands
islands <- read_xlsx(here("data", "Atoll - Island-Level-Indicator-Sheet-Population Cleaned V1.xlsx"),
sheet = 1,
skip = 7,
col_names = island_colnames) |>
slice(1:186) |>
rename(island = locality) |>
left_join(
islands_atolls,
by = c("island", "Atoll")
)
islands <- read_xlsx(here("data", "Atoll - Island-Level-Indicator-Sheet-Population Cleaned V1.xlsx"),
sheet = 1,
skip = 7,
col_names = island_colnames) |>
slice(1:186) |>
rename(island = Locality) |>
left_join(
islands_atolls,
by = c("island", "Atoll")
)
isalnd |> filter(!is.na(atoll_official))
island |> filter(!is.na(atoll_official))
islands |> filter(!is.na(atoll_official))
islands |> filter(is.na(atoll_official))
islands |>
glimpse()
islands |>
pivot_longer(cols = `Resident Population Both sexes`:`Median Age Resident Foreign`,
names_to = "indicator_full",
values_to = "value") |>
glimpse()
mutate(sex_modifier =
case_when(
str_detect(indicator_full, "Both sexes") ~ "Both sexes",
str_detect(indicator_full, "Male") ~ "Male",
str_detect(indicator_full, "Female") ~ "Female",
TRUE ~ NA_character_
),
population_modifier =
case_when(
str_detect(indicator_full, "Resident Population") ~ "Resident Population",
str_detect(indicator_full, "Resident Maldivian") ~ "Resident Maldivians",
str_detect(indicator_full, "Residnet Foreign") ~ "Resident Foreigners",
TRUE ~ NA_character_
))
islands |>
pivot_longer(cols = `Resident Population Both sexes`:`Median Age Resident Foreign`,
names_to = "indicator_full",
values_to = "value") |>
filter(!str_detect(indicator_full, "Resident Maldivians 2014")) |>
mutate(sex_modifier =
case_when(
str_detect(indicator_full, "Both sexes") ~ "Both sexes",
str_detect(indicator_full, "Male") ~ "Male",
str_detect(indicator_full, "Female") ~ "Female",
TRUE ~ NA_character_
),
population_modifier =
case_when(
str_detect(indicator_full, "Resident Population") ~ "Resident Population",
str_detect(indicator_full, "Resident Maldivian") ~ "Resident Maldivians",
str_detect(indicator_full, "Residnet Foreign") ~ "Resident Foreigners",
TRUE ~ NA_character_
))
island_cols <- read_xlsx(here("data", "Atoll - Island-Level-Indicator-Sheet-Population Cleaned V1.xlsx"),
sheet = 1) |>
slice(1:4) |>
clean_names()
island_colnames <- island_cols |>
pivot_longer(cols = everything(),
names_to = "ignore",
values_to = "dirty") |>
filter(!is.na(dirty)) |>
group_by(ignore) %>%
mutate(across(everything(), ~paste0(.,collapse = " "))) |>
slice(1) |>
ungroup() |>
mutate(order = parse_number(ignore)) |>
mutate(order = case_when(
dirty == "Atoll" ~ 1,
dirty == "Growth Rate (for Resident Maldivian Population - 2014 to 2022)" ~ 15,
TRUE ~ order),
dirty = ifelse(dirty == "* Area (in hectare)",
"Area (in hectare)", dirty)) |>
arrange(order) |>
pull(dirty)
islands_atolls <- read_xlsx(here("data", "Atoll - Island-Level-Indicator-Sheet-Population Cleaned V1.xlsx"),
sheet = 1,
skip = 7,
col_names = island_colnames) |>
slice(1:186) |>
distinct(Atoll, island = Locality) |>
left_join(
maldives |>
mutate(Atoll = str_extract_all(atoll_local_names, "\\([^()]+\\)"),
Atoll = str_remove_all(Atoll, "\\(|\\)")) |>
filter(!is.na(island)) |>
distinct(Atoll, island, atoll_official) |>
mutate(Atoll = case_when(Atoll == "ADh" ~ "Adh",
TRUE ~ Atoll),
island = case_when(island == "Mundhoo" ~ "Mundoo",
island == "Madeveli" ~ "Madaveli",
TRUE ~ island)),
by = c("Atoll", "island")
) |>
arrange(atoll_official)
islands <- read_xlsx(here("data", "Atoll - Island-Level-Indicator-Sheet-Population Cleaned V1.xlsx"),
sheet = 1,
skip = 7,
col_names = island_colnames) |>
slice(1:186) |>
rename(island = Locality) |>
left_join(
islands_atolls,
by = c("island", "Atoll")
) |>
pivot_longer(cols = `Resident Population Both sexes`:`Median Age Resident Foreign`,
names_to = "indicator_full",
values_to = "value") |>
filter(!str_detect(indicator_full, "Resident Maldivians 2014")) |>
mutate(sex_modifier =
case_when(
str_detect(indicator_full, "Both sexes") ~ "Both sexes",
str_detect(indicator_full, "Male") ~ "Male",
str_detect(indicator_full, "Female") ~ "Female",
TRUE ~ NA_character_
),
population_modifier =
case_when(
str_detect(indicator_full, "Resident Population") ~ "Resident Population",
str_detect(indicator_full, "Resident Maldivian") ~ "Resident Maldivians",
str_detect(indicator_full, "Residnet Foreign") ~ "Resident Foreigners",
TRUE ~ NA_character_
))
islands <- read_xlsx(here("data", "Atoll - Island-Level-Indicator-Sheet-Population Cleaned V1.xlsx"),
sheet = 1,
skip = 7,
col_names = island_colnames) |>
slice(1:186) |>
rename(island = Locality) |>
left_join(
islands_atolls,
by = c("island", "Atoll")
) |>
pivot_longer(cols = `Resident Population Both sexes`:`Median Age Resident Foreigners`,
names_to = "indicator_full",
values_to = "value") |>
filter(!str_detect(indicator_full, "Resident Maldivians 2014")) |>
mutate(sex_modifier =
case_when(
str_detect(indicator_full, "Both sexes") ~ "Both sexes",
str_detect(indicator_full, "Male") ~ "Male",
str_detect(indicator_full, "Female") ~ "Female",
TRUE ~ NA_character_
),
population_modifier =
case_when(
str_detect(indicator_full, "Resident Population") ~ "Resident Population",
str_detect(indicator_full, "Resident Maldivian") ~ "Resident Maldivians",
str_detect(indicator_full, "Residnet Foreign") ~ "Resident Foreigners",
TRUE ~ NA_character_
))
islands
glimpse()
islands |>
glimpse()
islands |>
glimpse()
islands |>
filter(population_modifier == "Resident Maldivians" | is.na(population_modifier)) |>
glimpse()
islands |>
filter(population_modifier == "Resident Maldivians" | is.na(population_modifier)) |>
filter(sex_modifier == "Both sexes" | is.na(sex_modifier))
islands |>
filter(population_modifier == "Resident Maldivians" | is.na(population_modifier)) |>
filter(sex_modifier == "Both sexes" | is.na(sex_modifier)) |>
count(indicator_full)
island_cols <- read_xlsx(here("data", "Atoll - Island-Level-Indicator-Sheet-Population Cleaned V1.xlsx"),
sheet = 1) |>
slice(1:4) |>
clean_names()
island_colnames <- island_cols |>
pivot_longer(cols = everything(),
names_to = "ignore",
values_to = "dirty") |>
filter(!is.na(dirty)) |>
group_by(ignore) %>%
mutate(across(everything(), ~paste0(.,collapse = " "))) |>
slice(1) |>
ungroup() |>
mutate(order = parse_number(ignore)) |>
mutate(order = case_when(
dirty == "Atoll" ~ 1,
dirty == "Growth Rate (for Resident Maldivian Population - 2014 to 2022)" ~ 15,
TRUE ~ order),
dirty = ifelse(dirty == "* Area (in hectare)",
"Area (in hectare)", dirty)) |>
arrange(order) |>
pull(dirty)
islands_atolls <- read_xlsx(here("data", "Atoll - Island-Level-Indicator-Sheet-Population Cleaned V1.xlsx"),
sheet = 1,
skip = 7,
col_names = island_colnames) |>
slice(1:186) |>
distinct(Atoll, island = Locality) |>
left_join(
maldives |>
mutate(Atoll = str_extract_all(atoll_local_names, "\\([^()]+\\)"),
Atoll = str_remove_all(Atoll, "\\(|\\)")) |>
filter(!is.na(island)) |>
distinct(Atoll, island, atoll_official) |>
mutate(Atoll = case_when(Atoll == "ADh" ~ "Adh",
TRUE ~ Atoll),
island = case_when(island == "Mundhoo" ~ "Mundoo",
island == "Madeveli" ~ "Madaveli",
TRUE ~ island)),
by = c("Atoll", "island")
) |>
arrange(atoll_official)
island_cols <- read_xlsx(here("data", "Atoll - Island-Level-Indicator-Sheet-Population Cleaned V1.xlsx"),
sheet = 1,
.name_repair = "unique_quiet") |>
slice(1:4) |>
clean_names()
islands |>
filter(population_modifier == "Resident Maldivians" | is.na(population_modifier)) |>
filter(sex_modifier == "Both sexes" | is.na(sex_modifier)) |>
count(indicator_full)
island_cols <- read_xlsx(here("data", "Atoll - Island-Level-Indicator-Sheet-Population Cleaned V1.xlsx"),
sheet = 1,
.name_repair = "unique_quiet") |>
slice(1:4) |>
clean_names()
island_colnames <- island_cols |>
pivot_longer(cols = everything(),
names_to = "ignore",
values_to = "dirty") |>
filter(!is.na(dirty)) |>
group_by(ignore) %>%
mutate(across(everything(), ~paste0(.,collapse = " "))) |>
slice(1) |>
ungroup() |>
mutate(order = parse_number(ignore)) |>
mutate(order = case_when(
dirty == "Atoll" ~ 1,
dirty == "Growth Rate (for Resident Maldivian Population - 2014 to 2022)" ~ 15,
TRUE ~ order),
dirty = ifelse(dirty == "* Area (in hectare)",
"Area (in hectare)", dirty)) |>
arrange(order) |>
pull(dirty)
islands_atolls <- read_xlsx(here("data", "Atoll - Island-Level-Indicator-Sheet-Population Cleaned V1.xlsx"),
sheet = 1,
skip = 7,
col_names = island_colnames) |>
slice(1:186) |>
distinct(Atoll, island = Locality) |>
left_join(
maldives |>
mutate(Atoll = str_extract_all(atoll_local_names, "\\([^()]+\\)"),
Atoll = str_remove_all(Atoll, "\\(|\\)")) |>
filter(!is.na(island)) |>
distinct(Atoll, island, atoll_official) |>
mutate(Atoll = case_when(Atoll == "ADh" ~ "Adh",
TRUE ~ Atoll),
island = case_when(island == "Mundhoo" ~ "Mundoo",
island == "Madeveli" ~ "Madaveli",
TRUE ~ island)),
by = c("Atoll", "island")
) |>
arrange(atoll_official)
islands <- read_xlsx(here("data", "Atoll - Island-Level-Indicator-Sheet-Population Cleaned V1.xlsx"),
sheet = 1,
skip = 7,
col_names = island_colnames) |>
slice(1:186) |>
rename(island = Locality) |>
left_join(
islands_atolls,
by = c("island", "Atoll")
) |>
pivot_longer(cols = `Resident Population Both sexes`:`Median Age Resident Foreigners`,
names_to = "indicator_full",
values_to = "value") |>
filter(!str_detect(indicator_full, "Resident Maldivians 2014")) |>
mutate(sex_modifier =
case_when(
str_detect(indicator_full, "Both sexes") ~ "Both sexes",
str_detect(indicator_full, "Male") ~ "Male",
str_detect(indicator_full, "Female") ~ "Female",
TRUE ~ NA_character_
),
population_modifier =
case_when(
str_detect(indicator_full, "Resident Population") ~ "Resident Population",
str_detect(indicator_full, "Resident Maldivian") ~ "Resident Maldivians",
str_detect(indicator_full, "Residnet Foreign") ~ "Resident Foreigners",
TRUE ~ NA_character_
))
islands |>
filter(population_modifier == "Resident Maldivians" | is.na(population_modifier)) |>
filter(sex_modifier == "Both sexes" | is.na(sex_modifier)) |>
count(indicator_full)
islands |>
filter(population_modifier == "Resident Maldivians" | is.na(population_modifier)) |>
filter(sex_modifier == "Both sexes" | is.na(sex_modifier)) |>
filter(indicator %out% c("Median Age Resident Foreigners",
"Resident Foreigners Population Both sexes")) |>
mutate(indicator = str_remove(indicator_full, "Resident Maldivian Population"))
islands |>
filter(population_modifier == "Resident Maldivians" | is.na(population_modifier)) |>
filter(sex_modifier == "Both sexes" | is.na(sex_modifier)) |>
filter(indicator_full %out% c("Median Age Resident Foreigners",
"Resident Foreigners Population Both sexes")) |>
mutate(indicator = str_remove(indicator_full, "Resident Maldivian Population"))
islands |>
filter(population_modifier == "Resident Maldivians" | is.na(population_modifier)) |>
filter(sex_modifier == "Both sexes" | is.na(sex_modifier)) |>
filter(indicator_full %out% c("Median Age Resident Foreigners",
"Resident Foreigners Population Both sexes")) |>
mutate(indicator = str_remove(indicator_full, "Resident Maldivian Population"),
indicator2 = indicator,
value2 = value) |>
write_csv(here("data", "maldives_islands.csv"))
islands |>
filter(population_modifier == "Resident Maldivians" | is.na(population_modifier)) |>
filter(sex_modifier == "Both sexes" | is.na(sex_modifier)) |>
filter(indicator_full %out% c("Median Age Resident Foreigners",
"Resident Foreigners Population Both sexes")) |>
mutate(indicator = str_remove(indicator_full, "Resident Maldivian Population"),
indicator2 = indicator,
value2 = value) |>
write_csv(here("data", "maldives_islands2.csv"))
islands |>
filter(population_modifier == "Resident Maldivians" | is.na(population_modifier)) |>
filter(sex_modifier == "Both sexes" | is.na(sex_modifier)) |>
filter(indicator_full %out% c("Median Age Resident Foreigners",
"Resident Foreigners Population Both sexes")) |>
mutate(indicator = str_remove(indicator_full, "Resident Maldivian Population"),
indicator2 = indicator,
value2 = value) |>
write_csv(here("data", "maldives_islands1.csv"))
islands |>
filter(population_modifier == "Resident Maldivians" | is.na(population_modifier)) |>
filter(sex_modifier == "Both sexes" | is.na(sex_modifier)) |>
filter(indicator_full %out% c("Median Age Resident Foreigners",
"Resident Foreigners Population Both sexes")) |>
mutate(indicator = str_remove(indicator_full, "Resident Maldivian Population"),
indicator2 = indicator,
value2 = value) |>
filter(is.na(value))
islands |>
filter(population_modifier == "Resident Maldivians" | is.na(population_modifier)) |>
filter(sex_modifier == "Both sexes" | is.na(sex_modifier)) |>
filter(indicator_full %out% c("Median Age Resident Foreigners",
"Resident Foreigners Population Both sexes")) |>
naniar::replace_with_na(list(value = "")) |>
mutate(indicator = str_remove(indicator_full, "Resident Maldivian Population"),
indicator2 = indicator,
value2 = value) |>
write_csv(here("data", "maldives_islands1.csv"))
islands |>
filter(population_modifier == "Resident Maldivians" | is.na(population_modifier)) |>
filter(sex_modifier == "Both sexes" | is.na(sex_modifier)) |>
filter(indicator_full %out% c("Median Age Resident Foreigners",
"Resident Foreigners Population Both sexes")) |>
naniar::replace_na(list(value = "")) |>
mutate(indicator = str_remove(indicator_full, "Resident Maldivian Population"),
indicator2 = indicator,
value2 = value) |>
write_csv(here("data", "maldives_islands1.csv"))
islands |>
filter(population_modifier == "Resident Maldivians" | is.na(population_modifier)) |>
filter(sex_modifier == "Both sexes" | is.na(sex_modifier)) |>
filter(indicator_full %out% c("Median Age Resident Foreigners",
"Resident Foreigners Population Both sexes")) |>
replace_na(list(value = "")) |>
mutate(indicator = str_remove(indicator_full, "Resident Maldivian Population"),
indicator2 = indicator,
value2 = value) |>
write_csv(here("data", "maldives_islands1.csv"))
islands |>
filter(population_modifier == "Resident Maldivians" | is.na(population_modifier)) |>
filter(sex_modifier == "Both sexes" | is.na(sex_modifier)) |>
filter(indicator_full %out% c("Median Age Resident Foreigners",
"Resident Foreigners Population Both sexes")) |>
mutate(indicator = str_remove(indicator_full, "Resident Maldivian Population"),
indicator2 = indicator,
value2 = value,
index = row_number()) |>
write_csv(here("data", "maldives_islands1.csv"))
islands |>
filter(population_modifier == "Resident Maldivians" | is.na(population_modifier)) |>
filter(sex_modifier == "Both sexes" | is.na(sex_modifier)) |>
filter(indicator_full %out% c("Median Age Resident Foreigners",
"Resident Foreigners Population Both sexes")) |>
mutate(indicator = str_remove(indicator_full, "Resident Maldivian Population"),
indicator2 = indicator,
value2 = value,
index = row_number()) |>
write_csv(here("data", "maldives_islands2.csv"))
islands |>
filter(population_modifier == "Resident Maldivians" | is.na(population_modifier)) |>
filter(sex_modifier == "Both sexes" | is.na(sex_modifier)) |>
filter(indicator_full %out% c("Median Age Resident Foreigners",
"Resident Foreigners Population Both sexes")) |>
mutate(indicator = str_remove(indicator_full, "Resident Maldivian Population"),
indicator2 = indicator,
value2 = value,
index = row_number())
islands |>
filter(population_modifier == "Resident Maldivians" | is.na(population_modifier)) |>
filter(sex_modifier == "Both sexes" | is.na(sex_modifier)) |>
filter(indicator_full %out% c("Median Age Resident Foreigners",
"Resident Foreigners Population Both sexes")) |>
mutate(indicator = str_remove(indicator_full, "Resident Maldivian Population"),
indicator2 = indicator,
value2 = value,
index = paste0(island, ", ",  atoll_offical)) |>
write_csv(here("data", "maldives_islands2.csv"))
islands
islands |>
filter(population_modifier == "Resident Maldivians" | is.na(population_modifier)) |>
filter(sex_modifier == "Both sexes" | is.na(sex_modifier)) |>
filter(indicator_full %out% c("Median Age Resident Foreigners",
"Resident Foreigners Population Both sexes")) |>
mutate(indicator = str_remove(indicator_full, "Resident Maldivian Population"),
indicator2 = indicator,
value2 = value,
index = paste0(island, ", ",  atoll_official)) |>
write_csv(here("data", "maldives_islands2.csv"))
islands |>
filter(population_modifier == "Resident Maldivians" | is.na(population_modifier)) |>
filter(sex_modifier == "Both sexes" | is.na(sex_modifier)) |>
filter(indicator_full %out% c("Median Age Resident Foreigners",
"Resident Foreigners Population Both sexes")) |>
mutate(indicator = str_remove(indicator_full, "Resident Maldivian Population"),
indicator2 = indicator,
value2 = value,
index = paste0(island, ", ",  atoll_official)) |>
write_csv(here("data", "maldives_islands1.csv"))
islands |> count(indicator)
islands |> count(indicator_full)
islands_pop <- islands |>
filter(indicator_full == "Resident Population Both sexes")
islands_pop
islands_pop <- islands |>
filter(indicator_full == "Resident Population Both sexes") |>
select(island, atoll_official, population = value)
islands_pop
islands_pop <- islands |>
filter(indicator_full == "Resident Population Both sexes") |>
select(island, atoll_official, population = value) |>
write_csv(here("data", "islands_pop.csv"))
